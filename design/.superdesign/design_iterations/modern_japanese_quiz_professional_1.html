<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Japanese Learning Quiz - Professional Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <link rel="stylesheet" href="professional_business_theme.css">
    <script src="https://www.youtube.com/iframe_api" async defer></script>
</head>
<body class="app-container">
    <!-- Particle Effects Container -->
    <div class="particle-container" id="particleContainer"></div>

    <!-- Header -->
    <header class="header-modern">
        <div class="header-content">
            <div class="logo-container">
                <div class="logo-icon">üìö</div>
                <h1 class="app-title">Japanese Learning Platform</h1>
            </div>
            <div class="header-controls">
                <button class="control-button theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
                    üåô
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Video Section -->
        <section class="video-section fade-in">
            <div class="video-container">
                <h2 class="video-title japanese-text">„Ç¢„É≥„Ç∏„É£„ÉÉ„Ç∑„É• „Éê„Ç§„Éà„ÅÆÈù¢Êé•</h2>
                <div class="video-wrapper">
                    <iframe
                        id="youtube-player"
                        width="100%"
                        height="100%"
                        src="https://www.youtube.com/embed/c8em2Kh5a1c?controls=0&rel=0&modestbranding=1&iv_load_policy=3&enablejsapi=1&autoplay=0&fs=1&cc_load_policy=0&disablekb=0"
                        title="Japanese Learning Video"
                        frameborder="0"
                        allowfullscreen
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share">
                    </iframe>
                </div>
                <div class="video-controls">
                    <button class="video-btn" onclick="togglePlay()" id="playBtn">
                        <i data-lucide="play"></i> PLAY
                    </button>
                    <button class="video-btn" onclick="skipBackward()">
                        <i data-lucide="skip-back"></i> -10s
                    </button>
                    <button class="video-btn" onclick="skipForward()">
                        <i data-lucide="skip-forward"></i> +10s
                    </button>
                    <button class="video-btn" onclick="toggleMute()" id="muteBtn">
                        <i data-lucide="volume-2"></i> AUDIO
                    </button>
                </div>

            </div>
        </section>

        <!-- Transcript Panel -->
        <aside class="transcript-panel slide-in">
            <div class="transcript-header">
                <h3 class="transcript-title">TRANSCRIPT</h3>
                <div class="transcript-controls">
                    <button class="control-btn" onclick="toggleTranscript()" id="transcriptToggle">
                        <i data-lucide="eye"></i>
                    </button>
                </div>
            </div>
            <div class="transcript-content" id="transcriptContent">
                <div class="transcript-line" data-timestamp="15">
                    <span class="timestamp">00:15</span>
                    <span class="japanese-text transcript-text">„Åì„Çì„Å´„Å°„ÅØÔºÅ„ÅØ„Åò„ÇÅ„Åæ„Åó„Å¶„ÄÇ</span>
                </div>
                <div class="transcript-line" data-timestamp="18">
                    <span class="timestamp">00:18</span>
                    <span class="japanese-text transcript-text">„ÅäÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü</span>
                </div>
                <div class="transcript-line" data-timestamp="23">
                    <span class="timestamp">00:23</span>
                    <span class="japanese-text transcript-text">„ÅØ„ÅÑ„ÄÅÂÖÉÊ∞ó„Åß„Åô„ÄÇ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ</span>
                </div>
                <div class="transcript-line" data-timestamp="28">
                    <span class="timestamp">00:28</span>
                    <span class="japanese-text transcript-text">„Åù„ÅÜ„Åß„Åô„Å≠„ÄÇ‰ªäÊó•„ÅØ„ÅÑ„ÅÑÂ§©Ê∞ó„Åß„Åô„Å≠„ÄÇ</span>
                </div>
                <div class="transcript-line" data-timestamp="32">
                    <span class="timestamp">00:32</span>
                    <span class="japanese-text transcript-text">„Åß„ÇÇ„ÄÅ‰ªï‰∫ã„Åå„Å®„Å¶„ÇÇÂøô„Åó„ÅÑ„Åß„Åô„ÄÇ</span>
                </div>
                <div class="transcript-line" data-timestamp="35">
                    <span class="timestamp">00:35</span>
                    <span class="japanese-text transcript-text">ÊØéÊó•„ÄÅÊúù„Åã„ÇâÂ§ú„Åæ„ÅßÂÉç„ÅÑ„Å¶„ÅÑ„Åæ„Åô„ÄÇ</span>
                </div>
                <div class="transcript-line" data-timestamp="40">
                    <span class="timestamp">00:40</span>
                    <span class="japanese-text transcript-text">Â§ßÂ§â„Åß„Åô„Åå„ÄÅ„ÇÑ„Çä„Åå„ÅÑ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ</span>
                </div>
                <div class="transcript-line" data-timestamp="45">
                    <span class="timestamp">00:45</span>
                    <span class="japanese-text transcript-text">„ÅäÁñ≤„ÇåÊßò„Åß„Åô„ÄÇÈ†ëÂºµ„Å£„Å¶„Åè„Å†„Åï„ÅÑ„Å≠„ÄÇ</span>
                </div>
                <div class="transcript-line" data-timestamp="50">
                    <span class="timestamp">00:50</span>
                    <span class="japanese-text transcript-text">„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ„Åù„Çå„Åß„ÅØ„ÄÅÂ§±Á§º„Åó„Åæ„Åô„ÄÇ</span>
                </div>
            </div>
        </aside>
    </div>

    <!-- Quiz Arena -->
    <section class="quiz-arena slide-in">
        <div class="quiz-content">
            <div class="quiz-header">
            <div class="quiz-info">
                <div class="question-counter">QUESTION 3/10</div>
                <div class="quiz-stats">
                    <span class="stat-item">CORRECT: <span class="stat-value">6/10</span></span>
                </div>
            </div>
            <div class="quiz-controls">
                <button class="quiz-btn" onclick="resetQuiz()">
                    <i data-lucide="rotate-ccw"></i> RESET
                </button>
            </div>
        </div>

        <div class="question-card" id="currentQuestion">
            <div class="question-text">
                <span>What did the man say about his job?</span>
            </div>

            <div class="answers-grid">
                <div class="answer-option" onclick="selectAnswer(this, 'A')" data-option="A">
                    <span class="option-label">A</span>
                    <span class="option-text japanese-text">„Åô„Åî„ÅèÂøô„Åó„ÅÑ„Åß„Åô</span>
                </div>
                <div class="answer-option" onclick="selectAnswer(this, 'B')" data-option="B">
                    <span class="option-label">B</span>
                    <span class="option-text japanese-text">„Å®„Å¶„ÇÇÊ•Ω„Åó„ÅÑ„Åß„Åô</span>
                </div>
                <div class="answer-option" onclick="selectAnswer(this, 'C')" data-option="C">
                    <span class="option-label">C</span>
                    <span class="option-text japanese-text">Èõ£„Åó„Åè„Å™„ÅÑ„Åß„Åô</span>
                </div>
                <div class="answer-option" onclick="selectAnswer(this, 'D')" data-option="D">
                    <span class="option-label">D</span>
                    <span class="option-text japanese-text">„ÇÇ„ÅÜ„Åô„ÅêÁµÇ„Çè„Çä„Åæ„Åô</span>
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-btn" onclick="resetCurrentQuestion()">
                    <i data-lucide="rotate-cw"></i> RESET QUESTION
                </button>
                <button class="action-btn primary" onclick="checkAnswer()" id="checkBtn" disabled>
                    <i data-lucide="check-circle"></i> CHECK ANSWER
                </button>
                <button class="action-btn" onclick="nextQuestion()" id="nextBtn" disabled style="display: none;">
                    <i data-lucide="arrow-right"></i> NEXT
                </button>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="quiz-progress">
            <div class="progress-bar-container" style="background: var(--muted); height: 8px; border-radius: 4px; margin-top: 2rem; overflow: hidden; border: 2px solid var(--border);">
                <div class="progress-bar-fill" style="height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); width: 30%; transition: width 0.5s ease; box-shadow: 0 0 10px var(--primary);"></div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.9rem; color: var(--muted-foreground);">
                <span>Progress: 3/10</span>
                <span>30% Complete</span>
            </div>
        </div>
        </div>
    </section>

    <!-- Floating Action Button -->
    <div class="floating-actions" style="position: fixed; bottom: 2rem; right: 2rem; z-index: 1000;">
        <button class="control-button" onclick="toggleFullscreen()" title="Fullscreen Mode" style="margin-bottom: 1rem; display: block;">
            <i data-lucide="maximize"></i>
        </button>
        <button class="control-button" onclick="showKeyboardShortcuts()" title="Keyboard Shortcuts">
            <i data-lucide="keyboard"></i>
        </button>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10, 10, 10, 0.9); z-index: 9999; align-items: center; justify-content: center;">
        <div class="loading-spinner" style="width: 60px; height: 60px; border: 4px solid var(--muted); border-top: 4px solid var(--accent); border-radius: 50%; animation: spin 1s linear infinite;"></div>
    </div>

    <!-- Success/Error Notifications -->
    <div class="notification-container" id="notifications" style="position: fixed; top: 100px; right: 2rem; z-index: 1001;"></div>

    <script>
        // Global variables
        let currentQuestionIndex = 0;
        let score = 750;
        let correctAnswers = 6;
        let totalQuestions = 10;
        let selectedAnswer = null;
        let isPlaying = false;
        let isMuted = false;
        let player = null;
        let transcriptVisible = true;
        let currentTranscriptLine = 0;

        // Sample questions data
        const questions = [
            {
                audio: "question1.mp3",
                text: "What did the man say about his job?",
                options: {
                    A: "„Åô„Åî„ÅèÂøô„Åó„ÅÑ„Åß„Åô",
                    B: "„Å®„Å¶„ÇÇÊ•Ω„Åó„ÅÑ„Åß„Åô",
                    C: "Èõ£„Åó„Åè„Å™„ÅÑ„Åß„Åô",
                    D: "„ÇÇ„ÅÜ„Åô„ÅêÁµÇ„Çè„Çä„Åæ„Åô"
                },
                correct: "B",
                hint: "Listen for words related to feelings about work"
            },
            // More questions would be added here
        ];

        // Initialize Lucide icons
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            initializeApp();
        });

        // Initialize the application
        function initializeApp() {
            initializeTheme();
            setupKeyboardShortcuts();
            updateProgressDisplay();
            createParticleSystem();
            setupTranscript();
            startTranscriptSync();
            initializeButtonStates();
        }

        function initializeButtonStates() {
            // Ensure buttons are properly disabled on app start
            const checkBtn = document.getElementById('checkBtn');
            const nextBtn = document.getElementById('nextBtn');

            checkBtn.disabled = true;
            checkBtn.style.opacity = '0.5';
            checkBtn.style.cursor = 'not-allowed';

            nextBtn.disabled = true;
            nextBtn.style.display = 'none';
            nextBtn.style.opacity = '0.5';
            nextBtn.style.cursor = 'not-allowed';

            selectedAnswer = null;

            console.log('Button states initialized - checkBtn disabled:', checkBtn.disabled, 'nextBtn disabled:', nextBtn.disabled);
        }

        // Transcript Functions
        function setupTranscript() {
            // Add click handlers for transcript lines
            document.querySelectorAll('.transcript-line').forEach(line => {
                line.addEventListener('click', function() {
                    const timestamp = parseInt(this.dataset.timestamp);
                    if (player) {
                        player.seekTo(timestamp);
                        highlightTranscriptLine(this);
                    }
                });
            });

        }

        function startTranscriptSync() {
            // Sync transcript with video playback
            setInterval(() => {
                if (player && isPlaying) {
                    const currentTime = Math.floor(player.getCurrentTime());
                    updateTranscriptHighlight(currentTime);
                }
            }, 500); // Check every 500ms
        }

        function updateTranscriptHighlight(currentTime) {
            const transcriptLines = document.querySelectorAll('.transcript-line');
            let activeLineIndex = -1;

            // Find the current active line based on timestamp
            transcriptLines.forEach((line, index) => {
                const timestamp = parseInt(line.dataset.timestamp);
                const nextTimestamp = index < transcriptLines.length - 1 ?
                    parseInt(transcriptLines[index + 1].dataset.timestamp) : Infinity;

                if (currentTime >= timestamp && currentTime < nextTimestamp) {
                    activeLineIndex = index;
                }
            });

            // Update highlighting
            transcriptLines.forEach((line, index) => {
                line.classList.remove('active');
                if (index === activeLineIndex) {
                    line.classList.add('active');
                    // Auto-scroll to active line
                    scrollToTranscriptLine(line);
                }
            });

            currentTranscriptLine = activeLineIndex;
        }

        function scrollToTranscriptLine(line) {
            const transcriptContent = document.getElementById('transcriptContent');
            const lineTop = line.offsetTop;
            const containerHeight = transcriptContent.clientHeight;
            const lineHeight = line.offsetHeight;

            // Calculate scroll position to center the line
            const scrollPosition = lineTop - (containerHeight / 2) + (lineHeight / 2);

            transcriptContent.scrollTo({
                top: Math.max(0, scrollPosition),
                behavior: 'smooth'
            });
        }

        function highlightTranscriptLine(line) {
            // Remove previous highlights
            document.querySelectorAll('.transcript-line').forEach(l => {
                l.classList.remove('active');
            });

            // Add highlight to clicked line
            line.classList.add('active');
            showNotification('üéØ Jumped to timestamp', 'info');
        }

        function toggleTranscript() {
            const transcriptContent = document.getElementById('transcriptContent');
            const toggleBtn = document.getElementById('transcriptToggle');

            transcriptVisible = !transcriptVisible;

            if (transcriptVisible) {
                transcriptContent.style.display = 'block';
                toggleBtn.innerHTML = '<i data-lucide="eye"></i>';
                showNotification('üëÅÔ∏è Transcript shown', 'info');
            } else {
                transcriptContent.style.display = 'none';
                toggleBtn.innerHTML = '<i data-lucide="eye-off"></i>';
                showNotification('üôà Transcript hidden', 'info');
            }

            lucide.createIcons();
        }


        // YouTube Player API
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtube-player', {
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            console.log('YouTube player ready');
        }

        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) {
                isPlaying = true;
                updatePlayButton();
            } else if (event.data == YT.PlayerState.PAUSED) {
                isPlaying = false;
                updatePlayButton();
            }
        }

        // Video controls
        function togglePlay() {
            if (!player) return;

            if (isPlaying) {
                player.pauseVideo();
            } else {
                player.playVideo();
            }
        }

        function updatePlayButton() {
            const playBtn = document.getElementById('playBtn');
            if (isPlaying) {
                playBtn.innerHTML = '<i data-lucide="pause"></i> PAUSE';
            } else {
                playBtn.innerHTML = '<i data-lucide="play"></i> PLAY';
            }
            lucide.createIcons();
        }

        function skipBackward() {
            if (player) {
                const currentTime = player.getCurrentTime();
                player.seekTo(Math.max(0, currentTime - 10));
            }
        }

        function skipForward() {
            if (player) {
                const currentTime = player.getCurrentTime();
                player.seekTo(currentTime + 10);
            }
        }

        function toggleMute() {
            if (!player) return;

            if (isMuted) {
                player.unMute();
                isMuted = false;
                document.getElementById('muteBtn').innerHTML = '<i data-lucide="volume-2"></i> AUDIO';
            } else {
                player.mute();
                isMuted = true;
                document.getElementById('muteBtn').innerHTML = '<i data-lucide="volume-x"></i> MUTED';
            }
            lucide.createIcons();
        }

        // Quiz functionality
        function selectAnswer(element, option) {
            // Don't allow selection if answer has been checked
            if (document.querySelector('.answer-option.correct') || document.querySelector('.answer-option.incorrect')) {
                return;
            }

            // Remove previous selections
            document.querySelectorAll('.answer-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // Select new option
            element.classList.add('selected');
            selectedAnswer = option;

            // Enable check answer button with proper styling
            const checkBtn = document.getElementById('checkBtn');
            checkBtn.disabled = false;
            checkBtn.style.opacity = '1';
            checkBtn.style.cursor = 'pointer';

            // Add interaction effect
            element.style.transform = 'scale(1.02)';
            setTimeout(() => {
                element.style.transform = '';
            }, 200);
        }

        function checkAnswer() {
            if (!selectedAnswer) {
                showNotification('Please select an answer!', 'error');
                return;
            }

            const currentQuestion = questions[currentQuestionIndex];
            const isCorrect = selectedAnswer === currentQuestion.correct;

            // Show answer feedback
            document.querySelectorAll('.answer-option').forEach(opt => {
                const optionLetter = opt.dataset.option;
                if (optionLetter === currentQuestion.correct) {
                    opt.classList.add('correct');
                } else if (optionLetter === selectedAnswer && !isCorrect) {
                    opt.classList.add('incorrect');
                }
            });

            if (isCorrect) {
                correctAnswers++;
                score += 100;
                createSuccessParticles();
                showNotification('Correct! Great job! üéâ', 'success');
            } else {
                showNotification('Incorrect. The correct answer is highlighted.', 'error');
            }

            // Hide check button and show next button
            const checkBtn = document.getElementById('checkBtn');
            const nextBtn = document.getElementById('nextBtn');

            checkBtn.style.display = 'none';
            nextBtn.style.display = 'inline-flex';
            nextBtn.disabled = false;
            nextBtn.style.opacity = '1';
            nextBtn.style.cursor = 'pointer';

            // Update stats immediately
            updateProgressDisplay();
        }

        function nextQuestion() {
            // Move to next question
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadNextQuestion();
            } else {
                completeQuiz();
            }
        }

        function loadNextQuestion() {
            // Reset question display
            document.querySelectorAll('.answer-option').forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });

            selectedAnswer = null;

            // Reset buttons to initial state
            const checkBtn = document.getElementById('checkBtn');
            const nextBtn = document.getElementById('nextBtn');

            checkBtn.disabled = true;
            checkBtn.style.display = 'inline-flex';
            checkBtn.style.opacity = '0.5';
            checkBtn.style.cursor = 'not-allowed';

            nextBtn.disabled = true;
            nextBtn.style.display = 'none';
            nextBtn.style.opacity = '0.5';
            nextBtn.style.cursor = 'not-allowed';

            // Update question counter
            document.querySelector('.question-counter').textContent = `QUESTION ${currentQuestionIndex + 1}/${totalQuestions}`;

            // Animation for new question
            const questionCard = document.getElementById('currentQuestion');
            questionCard.style.opacity = '0';
            questionCard.style.transform = 'translateY(20px)';

            setTimeout(() => {
                // Load new question content here
                questionCard.style.opacity = '1';
                questionCard.style.transform = 'translateY(0)';
            }, 300);
        }

        function updateProgressDisplay() {
            // Update quiz header stats
            const statValue = document.querySelector('.stat-value');
            if (statValue) {
                statValue.textContent = `${correctAnswers}/${totalQuestions}`;
            }

            // Update progress bar
            const progressBarFill = document.querySelector('.progress-bar-fill');
            if (progressBarFill) {
                const questionProgress = ((currentQuestionIndex + 1) / totalQuestions) * 100;
                progressBarFill.style.width = `${questionProgress}%`;

                // Update progress text
                const progressSection = document.querySelector('.quiz-progress');
                if (progressSection) {
                    progressSection.lastElementChild.innerHTML = `
                        <span>Progress: ${currentQuestionIndex + 1}/${totalQuestions}</span>
                        <span>${Math.round(questionProgress)}% Complete</span>
                    `;
                }
            }
        }


        function resetCurrentQuestion() {
            // Reset the current question's selected answers
            document.querySelectorAll('.answer-option').forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });

            selectedAnswer = null;

            // Reset buttons to initial state
            const checkBtn = document.getElementById('checkBtn');
            const nextBtn = document.getElementById('nextBtn');

            checkBtn.disabled = true;
            checkBtn.style.display = 'inline-flex';
            checkBtn.style.opacity = '0.5';
            checkBtn.style.cursor = 'not-allowed';

            nextBtn.disabled = true;
            nextBtn.style.display = 'none';
            nextBtn.style.opacity = '0.5';
            nextBtn.style.cursor = 'not-allowed';

            showNotification('üîÑ Question reset! Select your answer again.', 'info');
        }

        // Enhanced professional particle effect for correct answers
        function createSuccessParticles() {
            const container = document.getElementById('particleContainer');

            // Create more obvious and impressive particle bursts
            const burstTypes = ['gentle', 'rise', 'sparkle', 'confetti', 'stars'];

            for (let burst = 0; burst < 5; burst++) {
                setTimeout(() => {
                    const burstType = burstTypes[burst % burstTypes.length];
                    const centerX = Math.random() * (window.innerWidth - 200) + 100;
                    const centerY = Math.random() * (window.innerHeight / 3) + 100;

                    createProfessionalBurst(container, burstType, centerX, centerY);
                }, burst * 200);
            }

            // Add screen-wide celebration effect
            createCelebrationOverlay();
        }

        function createProfessionalBurst(container, type, centerX, centerY) {
            const colors = ['#2563eb', '#1d4ed8', '#1e40af', '#3b82f6', '#60a5fa', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b'];

            switch(type) {
                case 'gentle':
                    createGentleBurst(container, colors, centerX, centerY);
                    break;
                case 'rise':
                    createRiseBurst(container, colors, centerX, centerY);
                    break;
                case 'sparkle':
                    createSparkleBurst(container, colors, centerX, centerY);
                    break;
                case 'confetti':
                    createConfettiBurst(container, colors, centerX, centerY);
                    break;
                case 'stars':
                    createStarsBurst(container, colors, centerX, centerY);
                    break;
            }
        }

        function createConfettiBurst(container, colors, centerX, centerY) {
            const shapes = ['üéâ', 'üéä', 'üèÜ', '‚ö°', 'üíé', 'üåà'];
            for (let i = 0; i < 10; i++) {
                const particle = document.createElement('div');
                const shape = shapes[Math.floor(Math.random() * shapes.length)];

                particle.innerHTML = shape;
                particle.style.cssText = `
                    position: fixed;
                    font-size: ${Math.random() * 20 + 15}px;
                    pointer-events: none;
                    z-index: 9999;
                    left: ${centerX + Math.random() * 300 - 150}px;
                    top: ${centerY - 50}px;
                `;

                container.appendChild(particle);

                const fallDistance = Math.random() * 400 + 200;
                const sway = Math.random() * 100 - 50;

                particle.animate([
                    {
                        transform: 'translateY(0) translateX(0) rotate(0deg)',
                        opacity: 1
                    },
                    {
                        transform: `translateY(${fallDistance}px) translateX(${sway}px) rotate(360deg)`,
                        opacity: 0
                    }
                ], {
                    duration: 3000,
                    easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                }).onfinish = () => particle.remove();
            }
        }

        function createStarsBurst(container, colors, centerX, centerY) {
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                const color = colors[Math.floor(Math.random() * colors.length)];

                particle.innerHTML = '‚≠ê';
                particle.style.cssText = `
                    position: fixed;
                    color: ${color};
                    font-size: ${Math.random() * 30 + 20}px;
                    pointer-events: none;
                    z-index: 9999;
                    left: ${centerX}px;
                    top: ${centerY}px;
                    filter: drop-shadow(0 0 10px ${color});
                `;

                container.appendChild(particle);

                const angle = (i / 8) * Math.PI * 2;
                const distance = Math.random() * 200 + 100;
                const endX = Math.cos(angle) * distance;
                const endY = Math.sin(angle) * distance;

                particle.animate([
                    {
                        transform: 'translate(0, 0) scale(0) rotate(0deg)',
                        opacity: 0
                    },
                    {
                        transform: 'translate(0, 0) scale(1) rotate(180deg)',
                        opacity: 1,
                        offset: 0.3
                    },
                    {
                        transform: `translate(${endX}px, ${endY}px) scale(0) rotate(720deg)`,
                        opacity: 0
                    }
                ], {
                    duration: 2500,
                    easing: 'ease-out'
                }).onfinish = () => particle.remove();
            }
        }

        function createCelebrationOverlay() {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(45deg, rgba(37, 99, 235, 0.1), rgba(59, 130, 246, 0.1));
                z-index: 9998;
                pointer-events: none;
            `;

            document.body.appendChild(overlay);

            overlay.animate([
                { opacity: 0 },
                { opacity: 1 },
                { opacity: 0 }
            ], {
                duration: 1000,
                easing: 'ease-in-out'
            }).onfinish = () => overlay.remove();
        }

        function createGentleBurst(container, colors, centerX, centerY) {
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                const color = colors[Math.floor(Math.random() * colors.length)];
                const size = Math.random() * 8 + 4;

                const angle = (i / 20) * Math.PI * 2;
                const velocity = Math.random() * 120 + 80;
                const endX = centerX + Math.cos(angle) * velocity;
                const endY = centerY + Math.sin(angle) * velocity;

                particle.style.cssText = `
                    position: fixed;
                    width: ${size}px;
                    height: ${size}px;
                    background: ${color};
                    border-radius: 50%;
                    pointer-events: none;
                    z-index: 9999;
                    opacity: 1;
                    left: ${centerX}px;
                    top: ${centerY}px;
                    box-shadow: 0 0 10px ${color};
                `;

                container.appendChild(particle);

                particle.animate([
                    {
                        transform: 'translate(0, 0) scale(1)',
                        opacity: 1
                    },
                    {
                        transform: `translate(${endX - centerX}px, ${endY - centerY}px) scale(0)`,
                        opacity: 0
                    }
                ], {
                    duration: 2000,
                    easing: 'ease-out'
                }).onfinish = () => particle.remove();
            }
        }

        function createRiseBurst(container, colors, centerX, centerY) {
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    const size = Math.random() * 6 + 3;

                    particle.style.cssText = `
                        position: fixed;
                        width: ${size}px;
                        height: ${size}px;
                        background: ${color};
                        border-radius: 50%;
                        pointer-events: none;
                        z-index: 9999;
                        opacity: 1;
                        left: ${centerX + Math.random() * 80 - 40}px;
                        top: ${centerY}px;
                        box-shadow: 0 0 15px ${color};
                    `;

                    container.appendChild(particle);

                    particle.animate([
                        { transform: 'translateY(0)', opacity: 1 },
                        { transform: 'translateY(-250px)', opacity: 0 }
                    ], {
                        duration: 3000,
                        easing: 'ease-out'
                    }).onfinish = () => particle.remove();
                }, i * 80);
            }
        }

        function createSparkleBurst(container, colors, centerX, centerY) {
            const sparkleShapes = ['‚ú¶', '‚ú®', '‚≠ê', 'üåü', 'üí´', '‚úß'];
            for (let i = 0; i < 12; i++) {
                const particle = document.createElement('div');
                const color = colors[Math.floor(Math.random() * colors.length)];
                const shape = sparkleShapes[Math.floor(Math.random() * sparkleShapes.length)];

                particle.innerHTML = shape;
                particle.style.cssText = `
                    position: fixed;
                    color: ${color};
                    font-size: ${Math.random() * 24 + 16}px;
                    pointer-events: none;
                    z-index: 9999;
                    left: ${centerX + Math.random() * 200 - 100}px;
                    top: ${centerY + Math.random() * 200 - 100}px;
                    text-shadow: 0 0 10px ${color};
                `;

                container.appendChild(particle);

                particle.animate([
                    {
                        transform: 'scale(0) rotate(0deg)',
                        opacity: 1
                    },
                    {
                        transform: 'scale(2) rotate(360deg)',
                        opacity: 0
                    }
                ], {
                    duration: 2000,
                    easing: 'ease-out'
                }).onfinish = () => particle.remove();
            }
        }

        function createParticleSystem() {
            // Initialize subtle background particle system
            const container = document.getElementById('particleContainer');

            setInterval(() => {
                if (Math.random() < 0.05) { // 5% chance each interval
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = '-10px';
                    particle.style.background = 'var(--accent)';
                    particle.style.opacity = '0.1';
                    particle.style.animationDuration = '6s';

                    container.appendChild(particle);

                    setTimeout(() => particle.remove(), 6000);
                }
            }, 400);
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notifications');
            const notification = document.createElement('div');

            const colors = {
                success: 'var(--success)',
                error: 'var(--destructive)',
                info: 'var(--secondary)',
                warning: 'var(--warning)'
            };

            notification.style.cssText = `
                background: ${colors[type]};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: var(--radius);
                margin-bottom: 0.5rem;
                box-shadow: var(--shadow-soft);
                font-weight: 500;
                font-size: 0.9rem;
                animation: slideIn 0.3s ease-out;
                cursor: pointer;
            `;

            notification.textContent = message;
            notification.onclick = () => notification.remove();

            container.appendChild(notification);

            setTimeout(() => notification.remove(), 4000);
        }


        // Theme management
        function initializeTheme() {
            // Check for saved theme preference or default to dark mode
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (savedTheme === 'light' || (!savedTheme && !prefersDark)) {
                document.body.classList.add('light-mode');
            }

            updateThemeButton();
        }

        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const isLightMode = document.body.classList.contains('light-mode');

            // Save theme preference
            localStorage.setItem('theme', isLightMode ? 'light' : 'dark');

            updateThemeButton();
            showNotification(`üé® Switched to ${isLightMode ? 'light' : 'dark'} mode`, 'info');
        }

        function updateThemeButton() {
            const themeBtn = document.querySelector('.theme-toggle');
            const isLightMode = document.body.classList.contains('light-mode');
            themeBtn.textContent = isLightMode ? '‚òÄÔ∏è' : 'üåô';
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }


        function resetQuiz() {
            if (confirm('Are you sure you want to reset the quiz?')) {
                currentQuestionIndex = 0;
                correctAnswers = 0;
                score = 0;
                selectedAnswer = null;
                updateProgressDisplay();
                loadNextQuestion();
                showNotification('üîÑ Quiz reset successfully', 'info');
            }
        }

        function completeQuiz() {
            const finalScore = Math.round((correctAnswers / totalQuestions) * 100);
            let message = '';

            if (finalScore >= 90) {
                message = 'üèÜ EXCELLENT! You\'re a Japanese master!';
            } else if (finalScore >= 70) {
                message = 'üéâ GREAT JOB! Keep up the good work!';
            } else if (finalScore >= 50) {
                message = 'üëç GOOD EFFORT! Practice makes perfect!';
            } else {
                message = 'üí™ KEEP TRYING! You\'ll get better!';
            }

            showNotification(message, 'success');
            createSuccessParticles();
        }

        function showKeyboardShortcuts() {
            const shortcuts = `
                Keyboard Shortcuts:
                Space - Play/Pause video
                ‚Üê ‚Üí - Skip backward/forward
                1,2,3,4 - Select answers A,B,C,D
                Enter - Next question
                H - Show hint
                R - Replay audio
                F - Toggle fullscreen
            `;
            alert(shortcuts);
        }

        // Keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case ' ':
                        e.preventDefault();
                        togglePlay();
                        break;
                    case 'ArrowLeft':
                        skipBackward();
                        break;
                    case 'ArrowRight':
                        skipForward();
                        break;
                    case '1':
                        selectAnswerByKey('A');
                        break;
                    case '2':
                        selectAnswerByKey('B');
                        break;
                    case '3':
                        selectAnswerByKey('C');
                        break;
                    case '4':
                        selectAnswerByKey('D');
                        break;
                    case 'Enter':
                        if (!document.getElementById('nextBtn').disabled) {
                            nextQuestion();
                        }
                        break;
                    case 'r':
                    case 'R':
                        resetCurrentQuestion();
                        break;
                    case 'f':
                    case 'F':
                        toggleFullscreen();
                        break;
                }
            });
        }

        function selectAnswerByKey(option) {
            const optionElement = document.querySelector(`[data-option="${option}"]`);
            if (optionElement) {
                selectAnswer(optionElement, option);
            }
        }

        // Loading animation
        function showLoading() {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.display = 'flex';
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.display = 'none';
        }

        // Add loading spinner animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>